name: Security Scanning

on:
  workflow_dispatch:

jobs:
  get-branches-to-scan:
    runs-on: ubuntu-latest
    outputs:
      branches: ${{ steps.determine-branches.outputs.branches }}
    steps:
      - name: Checkout repository
        run: |
          echo "Hi there!"

  security-scan:
    runs-on: ubuntu-latest
    needs: [get-branches-to-scan]
    strategy:
      matrix:
        target: [code-editor-sagemaker-server, code-editor-server]
    steps:
      - name: Assume IAM Role
        run: |
          echo "Sleeping!"
          sleep 90s
          exit 1
  
  security-scan-global-dependencies:
    runs-on: ubuntu-latest
    needs: [get-branches-to-scan]
    strategy:
      fail-fast: false
      matrix:
        target: [code-editor-sagemaker-server, code-editor-server]
    steps:
      - name: Assume IAM Role v2
        run: |
          if [ "${{ matrix.target }}" = "code-editor-server" ]; then
            echo "Failing for code-editor-server"
            exit 1
          fi
          echo "I'm still running for code-editor-sagemaker-server"
          sleep 1m