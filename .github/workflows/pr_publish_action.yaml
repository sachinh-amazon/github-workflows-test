name: Security Scanning

on:
  workflow_dispatch:

jobs:
  get-branches-to-scan:
    runs-on: ubuntu-latest
    outputs:
      branches: ${{ steps.determine-branches.outputs.branches }}
    steps:
      - name: Checkout repository
        run: |
          echo "Hi there!"

  security-scan:
    runs-on: ubuntu-latest
    needs: [get-branches-to-scan]
    strategy:
      matrix:
        target: [code-editor-sagemaker-server, code-editor-server]
    steps:
      - name: Assume IAM Role
        run: |
          echo "PASS" > scan-success-${{ matrix.target }}.txt
      
      - name: Upload Success Indicator File
        uses: actions/upload-artifact@v4
        with:
          name: scan-success-${{ matrix.target }}
          path: scan-success-${{ matrix.target }}.txt
          compression-level: 0
          retention-days: 90

      - name: Download all artifact files
        uses: actions/download-artifact@v4
        with:
          pattern: scan-success-*
          merge-multiple: true
      
      - name: ls
        run: |
          ls -la
      

  
  # security-scan-global-dependencies:
  #   runs-on: ubuntu-latest
  #   needs: [get-branches-to-scan]
  #   strategy:
  #     matrix:
  #       target: [code-editor-sagemaker-server, code-editor-server]
  #   steps:
  #     - name: Assume IAM Role v2
  #       run: |
  #         if [ "${{ matrix.target }}" = "code-editor-server" ]; then
  #           echo "Failing for code-editor-server"
  #           exit 1
  #         fi
  #         echo "I'm still running for code-editor-sagemaker-server"
  #         sleep 1m